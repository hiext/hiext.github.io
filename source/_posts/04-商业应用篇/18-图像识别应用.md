# 第18章：图像识别应用

## 📝 本章目标
- 掌握目标检测技术
- 学习人脸识别系统
- 实现OCR文字识别
- 开发智能安防系统

## 18.1 目标检测(YOLO)

```python
import cv2
from ultralytics import YOLO

class ObjectDetector:
    def __init__(self, model_path='yolov8n.pt'):
        self.model = YOLO(model_path)
    
    def detect(self, image_path):
        results = self.model(image_path)
        
        detections = []
        for result in results:
            for box in result.boxes:
                detections.append({
                    'class': result.names[int(box.cls)],
                    'confidence': float(box.conf),
                    'bbox': box.xyxy[0].tolist()
                })
        
        return detections

# 使用
detector = ObjectDetector()
results = detector.detect('image.jpg')
```

## 18.2 人脸识别

```python
import face_recognition
import cv2

class FaceRecognition:
    def __init__(self):
        self.known_faces = {}
    
    def add_face(self, name, image_path):
        """添加已知人脸"""
        image = face_recognition.load_image_file(image_path)
        encoding = face_recognition.face_encodings(image)[0]
        self.known_faces[name] = encoding
    
    def recognize(self, image_path):
        """识别人脸"""
        image = face_recognition.load_image_file(image_path)
        face_locations = face_recognition.face_locations(image)
        face_encodings = face_recognition.face_encodings(image, face_locations)
        
        results = []
        for encoding in face_encodings:
            matches = face_recognition.compare_faces(
                list(self.known_faces.values()),
                encoding
            )
            
            name = "Unknown"
            if True in matches:
                match_index = matches.index(True)
                name = list(self.known_faces.keys())[match_index]
            
            results.append(name)
        
        return results

# 使用
fr = FaceRecognition()
fr.add_face("张三", "zhangsan.jpg")
names = fr.recognize("group_photo.jpg")
```

## 18.3 OCR文字识别

```python
import easyocr

class OCRSystem:
    def __init__(self, languages=['ch_sim', 'en']):
        self.reader = easyocr.Reader(languages)
    
    def extract_text(self, image_path):
        """提取文字"""
        results = self.reader.readtext(image_path)
        
        texts = []
        for (bbox, text, conf) in results:
            texts.append({
                'text': text,
                'confidence': conf,
                'bbox': bbox
            })
        
        return texts

# 使用
ocr = OCRSystem()
texts = ocr.extract_text('document.jpg')
for item in texts:
    print(f"{item['text']} (置信度: {item['confidence']:.2f})")
```

## 18.4 智能安防系统

```python
class SecuritySystem:
    def __init__(self):
        self.face_rec = FaceRecognition()
        self.detector = ObjectDetector()
        self.alert_threshold = 0.8
    
    def monitor(self, video_source=0):
        """实时监控"""
        cap = cv2.VideoCapture(video_source)
        
        while True:
            ret, frame = cap.read()
            if not ret:
                break
            
            # 人脸识别
            rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
            face_locations = face_recognition.face_locations(rgb_frame)
            
            if face_locations:
                encodings = face_recognition.face_encodings(rgb_frame, face_locations)
                
                for encoding, location in zip(encodings, face_locations):
                    name = self._identify_face(encoding)
                    
                    if name == "Unknown":
                        self._trigger_alert("检测到陌生人")
                    
                    # 绘制边框
                    top, right, bottom, left = location
                    cv2.rectangle(frame, (left, top), (right, bottom), (0, 255, 0), 2)
                    cv2.putText(frame, name, (left, top - 10), 
                               cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)
            
            cv2.imshow('Security Monitor', frame)
            
            if cv2.waitKey(1) & 0xFF == ord('q'):
                break
        
        cap.release()
        cv2.destroyAllWindows()
    
    def _identify_face(self, encoding):
        """识别人脸"""
        matches = face_recognition.compare_faces(
            list(self.face_rec.known_faces.values()),
            encoding
        )
        
        if True in matches:
            match_index = matches.index(True)
            return list(self.face_rec.known_faces.keys())[match_index]
        return "Unknown"
    
    def _trigger_alert(self, message):
        """触发警报"""
        print(f"⚠️  警报: {message}")
        # 这里可以添加发送通知、保存图片等逻辑

# 使用
system = SecuritySystem()
system.face_rec.add_face("张三", "authorized_person.jpg")
system.monitor()
```

## 📚 本章小结
- ✅ YOLO目标检测
- ✅ 人脸识别系统
- ✅ OCR文字识别
- ✅ 智能安防应用
- ✅ 实时视频处理

[⬅️ 上一章](./17-智能客服系统.md) | [返回目录](../README.md) | [下一章 ➡️](./19-预测分析系统.md)
