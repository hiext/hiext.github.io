# 第17章：智能客服系统

## 📝 本章目标
- 理解对话系统架构
- 掌握意图识别技术
- 学习对话管理策略
- 开发完整智能客服

## 17.1 对话系统架构

```
用户输入 → 意图识别 → 槽位填充 → 对话管理 → 回复生成 → 用户输出
```

## 17.2 意图识别

```python
from transformers import pipeline

class IntentClassifier:
    def __init__(self):
        self.classifier = pipeline(
            "text-classification",
            model="bert-base-chinese"
        )
        
        self.intents = {
            '查询订单': ['订单', '物流', '快递'],
            '退换货': ['退货', '换货', '退款'],
            '产品咨询': ['价格', '功能', '参数'],
            '投诉建议': ['投诉', '建议', '差评']
        }
    
    def predict(self, text):
        result = self.classifier(text)[0]
        return result['label'], result['score']
```

## 17.3 对话管理

```python
class DialogueManager:
    def __init__(self):
        self.context = {}
        self.state = 'idle'
    
    def process(self, user_input, intent):
        if intent == '查询订单':
            if 'order_id' not in self.context:
                return "请提供您的订单号"
            else:
                return self.query_order(self.context['order_id'])
        
        elif intent == '退换货':
            return self.handle_return()
        
        else:
            return "我不太理解，能具体说明吗？"
    
    def query_order(self, order_id):
        # 查询订单逻辑
        return f"订单{order_id}的状态是：已发货"
    
    def handle_return(self):
        return "请提供订单号和退货原因"
```

## 17.4 完整客服系统

```python
class CustomerServiceBot:
    def __init__(self):
        self.intent_classifier = IntentClassifier()
        self.dialogue_manager = DialogueManager()
        self.history = []
    
    def chat(self, user_input):
        # 意图识别
        intent, confidence = self.intent_classifier.predict(user_input)
        
        # 对话管理
        response = self.dialogue_manager.process(user_input, intent)
        
        # 记录历史
        self.history.append({
            'user': user_input,
            'bot': response,
            'intent': intent
        })
        
        return response

# 使用
bot = CustomerServiceBot()
print(bot.chat("我想查询订单"))
print(bot.chat("订单号是12345"))
```

## 17.5 基于RAG的客服

```python
from langchain.vectorstores import Chroma
from langchain.embeddings import OpenAIEmbeddings
from langchain.llms import OpenAI

class RAGCustomerService:
    def __init__(self, knowledge_base_path):
        self.embeddings = OpenAIEmbeddings()
        self.vectorstore = Chroma(
            persist_directory=knowledge_base_path,
            embedding_function=self.embeddings
        )
        self.llm = OpenAI(temperature=0.7)
    
    def answer(self, question):
        # 检索相关文档
        docs = self.vectorstore.similarity_search(question, k=3)
        
        # 构建提示词
        context = "\n".join([doc.page_content for doc in docs])
        prompt = f"""
        基于以下知识回答用户问题：
        
        知识：
        {context}
        
        问题：{question}
        
        回答：
        """
        
        # 生成回复
        response = self.llm(prompt)
        return response
```

## 📚 本章小结
- ✅ 对话系统架构
- ✅ 意图识别实现
- ✅ 对话管理策略
- ✅ 完整客服系统
- ✅ RAG增强客服

[⬅️ 上一章](./16-推荐系统.md) | [返回目录](../README.md) | [下一章 ➡️](./18-图像识别应用.md)
