# 第21章：语音技术应用

## 📝 本章目标
- 掌握语音识别技术
- 学习语音合成方法
- 了解声纹识别
- 开发语音助手系统

## 20.1 语音识别(ASR)

```python
import speech_recognition as sr

class SpeechRecognizer:
    def __init__(self):
        self.recognizer = sr.Recognizer()
    
    def recognize_from_file(self, audio_file):
        with sr.AudioFile(audio_file) as source:
            audio = self.recognizer.record(source)
        
        try:
            text = self.recognizer.recognize_google(audio, language='zh-CN')
            return text
        except sr.UnknownValueError:
            return "无法识别语音"
    
    def recognize_from_microphone(self):
        with sr.Microphone() as source:
            print("请说话...")
            audio = self.recognizer.listen(source)
        
        try:
            text = self.recognizer.recognize_google(audio, language='zh-CN')
            return text
        except sr.UnknownValueError:
            return "无法识别语音"

recognizer = SpeechRecognizer()
text = recognizer.recognize_from_microphone()
```

## 21.2 语音合成(TTS)

```python
from gtts import gTTS
import os

class TextToSpeech:
    def __init__(self, language='zh'):
        self.language = language
    
    def synthesize(self, text, output_file='output.mp3'):
        tts = gTTS(text=text, lang=self.language, slow=False)
        tts.save(output_file)
        return output_file
    
    def speak(self, text):
        output_file = self.synthesize(text)
        os.system(f'start {output_file}')  # Windows
        # os.system(f'afplay {output_file}')  # macOS

tts = TextToSpeech()
tts.speak("你好，欢迎使用语音助手")
```

## 21.3 智能语音助手

```python
class VoiceAssistant:
    def __init__(self):
        self.recognizer = SpeechRecognizer()
        self.tts = TextToSpeech()
        self.conversation_history = []
    
    def listen(self):
        text = self.recognizer.recognize_from_microphone()
        print(f"识别结果: {text}")
        return text
    
    def think(self, user_input):
        # 这里可以集成ChatGPT等LLM
        from langchain.llms import OpenAI
        
        llm = OpenAI(temperature=0.7)
        response = llm(user_input)
        return response
    
    def speak(self, text):
        print(f"助手回复: {text}")
        self.tts.speak(text)
    
    def run(self):
        self.speak("你好，我是智能助手，有什么可以帮你？")
        
        while True:
            user_input = self.listen()
            
            if "退出" in user_input or "再见" in user_input:
                self.speak("再见！")
                break
            
            response = self.think(user_input)
            self.speak(response)

assistant = VoiceAssistant()
assistant.run()
```

## 21.4 声纹识别

```python
import librosa
import numpy as np

class VoiceprintRecognition:
    def __init__(self):
        self.voiceprints = {}
    
    def extract_features(self, audio_file):
        y, sr = librosa.load(audio_file)
        
        # 提取MFCC特征
        mfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13)
        mfcc_mean = np.mean(mfcc, axis=1)
        
        return mfcc_mean
    
    def register(self, name, audio_file):
        features = self.extract_features(audio_file)
        self.voiceprints[name] = features
    
    def verify(self, audio_file, threshold=0.8):
        features = self.extract_features(audio_file)
        
        best_match = None
        best_similarity = 0
        
        for name, stored_features in self.voiceprints.items():
            similarity = self._cosine_similarity(features, stored_features)
            if similarity > best_similarity:
                best_similarity = similarity
                best_match = name
        
        if best_similarity > threshold:
            return best_match, best_similarity
        else:
            return None, best_similarity
    
    @staticmethod
    def _cosine_similarity(a, b):
        return np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b))
```

## 📚 本章小结
- ✅ 语音识别(ASR)
- ✅ 语音合成(TTS)
- ✅ 智能语音助手
- ✅ 声纹识别系统

[⬅️ 上一章](./20-内容生成应用.md) | [返回目录](../README.md) | [下一章 ➡️](../05-综合项目/22-医疗诊断助手.md)
