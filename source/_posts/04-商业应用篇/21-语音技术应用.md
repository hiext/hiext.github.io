# ç¬¬21ç« ï¼šè¯­éŸ³æŠ€æœ¯åº”ç”¨

## ğŸ“ æœ¬ç« ç›®æ ‡
- æŒæ¡è¯­éŸ³è¯†åˆ«æŠ€æœ¯
- å­¦ä¹ è¯­éŸ³åˆæˆæ–¹æ³•
- äº†è§£å£°çº¹è¯†åˆ«
- å¼€å‘è¯­éŸ³åŠ©æ‰‹ç³»ç»Ÿ

## 20.1 è¯­éŸ³è¯†åˆ«(ASR)

```python
import speech_recognition as sr

class SpeechRecognizer:
    def __init__(self):
        self.recognizer = sr.Recognizer()
    
    def recognize_from_file(self, audio_file):
        with sr.AudioFile(audio_file) as source:
            audio = self.recognizer.record(source)
        
        try:
            text = self.recognizer.recognize_google(audio, language='zh-CN')
            return text
        except sr.UnknownValueError:
            return "æ— æ³•è¯†åˆ«è¯­éŸ³"
    
    def recognize_from_microphone(self):
        with sr.Microphone() as source:
            print("è¯·è¯´è¯...")
            audio = self.recognizer.listen(source)
        
        try:
            text = self.recognizer.recognize_google(audio, language='zh-CN')
            return text
        except sr.UnknownValueError:
            return "æ— æ³•è¯†åˆ«è¯­éŸ³"

recognizer = SpeechRecognizer()
text = recognizer.recognize_from_microphone()
```

## 21.2 è¯­éŸ³åˆæˆ(TTS)

```python
from gtts import gTTS
import os

class TextToSpeech:
    def __init__(self, language='zh'):
        self.language = language
    
    def synthesize(self, text, output_file='output.mp3'):
        tts = gTTS(text=text, lang=self.language, slow=False)
        tts.save(output_file)
        return output_file
    
    def speak(self, text):
        output_file = self.synthesize(text)
        os.system(f'start {output_file}')  # Windows
        # os.system(f'afplay {output_file}')  # macOS

tts = TextToSpeech()
tts.speak("ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨è¯­éŸ³åŠ©æ‰‹")
```

## 21.3 æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹

```python
class VoiceAssistant:
    def __init__(self):
        self.recognizer = SpeechRecognizer()
        self.tts = TextToSpeech()
        self.conversation_history = []
    
    def listen(self):
        text = self.recognizer.recognize_from_microphone()
        print(f"è¯†åˆ«ç»“æœ: {text}")
        return text
    
    def think(self, user_input):
        # è¿™é‡Œå¯ä»¥é›†æˆChatGPTç­‰LLM
        from langchain.llms import OpenAI
        
        llm = OpenAI(temperature=0.7)
        response = llm(user_input)
        return response
    
    def speak(self, text):
        print(f"åŠ©æ‰‹å›å¤: {text}")
        self.tts.speak(text)
    
    def run(self):
        self.speak("ä½ å¥½ï¼Œæˆ‘æ˜¯æ™ºèƒ½åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ ï¼Ÿ")
        
        while True:
            user_input = self.listen()
            
            if "é€€å‡º" in user_input or "å†è§" in user_input:
                self.speak("å†è§ï¼")
                break
            
            response = self.think(user_input)
            self.speak(response)

assistant = VoiceAssistant()
assistant.run()
```

## 21.4 å£°çº¹è¯†åˆ«

```python
import librosa
import numpy as np

class VoiceprintRecognition:
    def __init__(self):
        self.voiceprints = {}
    
    def extract_features(self, audio_file):
        y, sr = librosa.load(audio_file)
        
        # æå–MFCCç‰¹å¾
        mfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13)
        mfcc_mean = np.mean(mfcc, axis=1)
        
        return mfcc_mean
    
    def register(self, name, audio_file):
        features = self.extract_features(audio_file)
        self.voiceprints[name] = features
    
    def verify(self, audio_file, threshold=0.8):
        features = self.extract_features(audio_file)
        
        best_match = None
        best_similarity = 0
        
        for name, stored_features in self.voiceprints.items():
            similarity = self._cosine_similarity(features, stored_features)
            if similarity > best_similarity:
                best_similarity = similarity
                best_match = name
        
        if best_similarity > threshold:
            return best_match, best_similarity
        else:
            return None, best_similarity
    
    @staticmethod
    def _cosine_similarity(a, b):
        return np.dot(a, b) / (np.linalg.norm(a) * np.linalg.norm(b))
```

## ğŸ“š æœ¬ç« å°ç»“
- âœ… è¯­éŸ³è¯†åˆ«(ASR)
- âœ… è¯­éŸ³åˆæˆ(TTS)
- âœ… æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹
- âœ… å£°çº¹è¯†åˆ«ç³»ç»Ÿ

[â¬…ï¸ ä¸Šä¸€ç« ](./20-å†…å®¹ç”Ÿæˆåº”ç”¨.md) | [è¿”å›ç›®å½•](../README.md) | [ä¸‹ä¸€ç«  â¡ï¸](../05-ç»¼åˆé¡¹ç›®/22-åŒ»ç–—è¯Šæ–­åŠ©æ‰‹.md)
